<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Details - Foodify</title>
    <!-- TomTom Maps SDK -->
    <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps.css'>
    <link rel='stylesheet' type='text/css' href='https://api.tomtom.com/maps-sdk-for-web/cdn/plugins/SearchBox/3.2.0/SearchBox.css'>
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps-web.min.js"></script>
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/services/services-web.min.js"></script>
    <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/plugins/SearchBox/3.2.0/SearchBox-web.js"></script>
    <!-- Your CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/delivery.css') }}">
</head>
<body class="{{ 'user-logged-in' if current_user.is_authenticated else '' }}">
    <div class="delivery-container">
        <!-- Location Prompt -->
        <div id="locationPrompt" class="location-prompt">
            <h2>Delivery Location</h2>
            <p>Would you like to continue with your stored location?</p>
            {% if stored_location %}
                <p class="stored-address">{{ stored_location.address }}</p>
            {% endif %}
            <div class="button-group">
                <button id="useStoredLocation" class="btn primary">Yes</button>
                <button id="selectNewLocation" class="btn secondary">No</button>
            </div>
        </div>

        <!-- Map Section -->
        <div id="mapSection" class="map-section" style="display: none;">
            <div id="map"></div>
            <script>
                // Verify TomTom SDK is loaded
                if (typeof tt === 'undefined') {
                    console.error('TomTom SDK not loaded');
                }
            </script>
            <div class="location-search">
                <button id="geolocateMe" class="btn">
                    <i class="fas fa-location-arrow"></i> Use My Location
                </button>
            </div>
            <!-- Delivery Form -->
            <div class="delivery-details">
                <form id="locationForm">
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" id="address" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="instructions">Delivery Instructions</label>
                        <textarea id="instructions" placeholder="Apartment number, landmarks, etc"></textarea>
                    </div>
                    <button type="submit" class="btn primary">Confirm Location</button>
                </form>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/delivery.js') }}"></script>
</body>
</html>